#!/bin/sh

elisp() {
  emacsclient --eval "(progn $@)"
}

calc() {
    echo "$*" | bc -l
}

task="$(elisp org-clock-current-task | tr -d '"')"
task=${task:-nil}
[ "${task}" = "nil" ] && echo "" && exit

# assume we're doing pomorodo, show a bar w/ percentage to end of current cycle with task.
interval="$(calc '25 * 60')"
cycle_start=$(elisp "(format-time-string \"%s\" org-clock-start-time)" | tr -d '"')

cycle_end=$(echo $seconds_start \+ $interval)
current_time=$(date +%s)

progress="$(calc "${current_time} - ${cycle_start}")"
percent="$(calc "${progress} / ${interval} * 100" | sed 's/\..*//')"

percent=${percent:-0}
echo ${task} $(mkb ${percent} 10 ◼ ◻ ◼)
