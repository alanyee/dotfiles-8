# -*- mode: sh -*-
set -a

silent() {
  "$@" >/dev/null 2>&1
}

has() {
  silent type "$@" 
}

# less status line
LESS='-R -f -X -i -P ?f%f:(stdin). ?lb%lb?L/%L.. [?eEOF:?pb%pb\%..]'
LESSCHARSET='utf-8'

BROWSER=qutebrowser
TERMINAL=st
FILEBROWSER=thunar
VIEW_PDF=zathura

# default
GTK_THEME=${GTK_THEME:-adwaita}
SXHKD_SHELL=sh
MPDCRON_DIR="$HOME/.config/mpd"
_JAVA_AWT_WM_NONREPARENTING=1
LANG="en_US.UTF-8"
TERMCMD="$TERMINAL"

# enforce emacs --server preference 
if has emacs && silent emacsclient --eval "(progn desktop-save-mode)"; then 
    EDITOR='emacsclient'
else
  EDITOR='vim'
fi

GIT_EDITOR="$EDITOR"
SVN_EDITOR="$EDITOR"

if has npm; then
    if has cache_output; then
	week="$(expr 60 \* 60 \* 24 \* 7)"
	NODE_PATH="$(cache_output $week npm root -g)"
	PATH="$PATH:$(cache_output $week npm bin -g)"
    else
      NODE_PATH="$(npm root -g)"
      PATH="$PATH:$(npm bin -g)"
    fi
fi

NODE_PATH="$HOME/.npm-packages/lib/node_modules"
PATH="$PATH:$HOME/.npm-packages/bin"

GEM_HOME="$HOME/.gem"
BUNDLE_PATH="$HOME/.gem"
GOPATH="$HOME/.go"

if [ -e $HOME/.nix-profile/etc/profile.d/nix.sh ]; then
  . $HOME/.nix-profile/etc/profile.d/nix.sh; 
fi 

path_add() {
  PATH="$PATH:$HOME/$@"
}

path_add bin
path_add .gem/bin
path_add .go/bin
path_add .cargo/bin
path_add .wm/scripts/interact
path_add .wm/scripts/visual
path_add .config/guix/current/bin

if [ -n "$INSIDE_EMACS" ]; then
    ESHELL=true
else
  ESHELL=false
fi

$ESHELL && PAGER="epager" || PAGER="less"

GUIX_LOCPATH="$HOME/.guix-profile/lib/locale"

set +a
