#!/bin/sh

ESHELL=${ESHELL:-false}

if $ESHELL; then
    candidates=""
    while read -u 0 -r line; do
	candidates="${candidates}"$'\n'"${line}"
    done

    candidates="'${candidates}'"
    lisp='(ivy-read "" (s-split "\n" (ns/shell-exec "printf '"${candidates}"'")) :action (lambda(option) option))'

    if result="$(elisp "${lisp}")"
    then
	echo "$result" | sed -e 's/^"//' -e 's/"$//'
    else
	exit 1
    fi
else
    fzf="$(type -a fzf | awk 'END{print $3}')"
    $fzf
fi
