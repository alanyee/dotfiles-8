#!/bin/sh

theme_dir="$HOME/.wm/themes"

die() {
  echo $*
  exit 1
}

# load the current theme values (meant to be eval'd)
get() {
    echo unset bg fg line prefix suffix activebg activefg activeline
    echo THEME_NAME=\"$(basename "$(readlink "$HOME/.wm_theme")")\"
    echo . "$HOME/.wm/scripts/theming/defaults"
    echo . "$HOME/.wm_theme"
}

# load existing theme into target editing
load() {
  name="$1"
  shift
  [ -z "$name" ] && die load needs a name.
  [ ! -f "$theme_dir/$name" ] && die $name not found

  rm $HOME/.wm_theme
  ln -s "$theme_dir/$name" "$HOME/.wm_theme"

  "$HOME/.wm/scripts/theming/ltheme" $*
}

edit() {
  $EDITOR "$theme_dir/$target"
}

new() {
    name="$*"
    [ -z "$name" ] && die new needs a name.
    eval "$(theme get)"
    cp "$theme_dir/colors/THEME_NAME" "$theme_dir/colors/$name"
    echo "#/bin/sh" > "$theme_dir/$name"
    ltheme "$name"
    edit "$name"
}

"$@"
